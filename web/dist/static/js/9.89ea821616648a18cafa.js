webpackJsonp([9],{"2hBI":function(t,e){},DipY:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("mvHQ"),i=n.n(s),o=n("Dd8w"),c=n.n(o),a=n("NYxO"),l=n("Y54T"),r=n("Au9i"),h=n("yojn"),u=n.n(h),d={data:function(){return{blueEnable:!1,scanDeviceList:[],configType:"",isBleScan:!0,locationGranted:!0,locationEnabled:!0,pushDeviceId:"",connectContent:0,connectData:"",timeOutLoading:"",loadingMsg:this.$t("connecting"),isBleConnect:!1}},created:function(){var t=this;window.scanCallback=function(e){t.scanCallback(e)},window.connectCallback=function(e){t.connectCallback(e)},window.onBackPressed=function(){t.onBackPressed()},window.provisioningCallback=function(e){t.provisioningCallback(e)}},watch:{$route:"getPath"},methods:c()({},Object(a.c)({setNum:"SET_NUM"}),{scanDevice:function(t){if(console.log("扫描或者停止扫描 scanDevice : "+t),t){if(console.log("blueEnable:"+this.blueEnable+"  locationEnabled:"+this.locationEnabled+"  locationGranted:"+this.locationGranted),!this.blueEnable)return void this.messageRemind(this.$t("notbluetooth"));if(!this.locationEnabled)return void this.messageRemind(this.$t("notlocation"));if(!this.locationGranted)return void this.messageRemind(this.$t("notgps"));EspBleMesh.startScan(i()({type:"provisioning"})),this.isBleScan=!1}else EspBleMesh.webLog("停止扫描"),EspBleMesh.stopScan(),this.isBleScan=!0},getPath:function(){console.log("scan 路由发生变化"+this.$route.path)},messageRemind:function(t){Object(r.Toast)({message:t,position:"bottom"})},getRssiIcon:function(t){return l.a.getBLERssiIcon(t)},showBlueFail:function(){console.log("点击蓝牙按钮")},hide:function(){setTimeout(function(){EspBleMesh.stopScan()}),this.scanDeviceList=[],console.log("返回 Home 页面"),this.isBleScan=!0,this.$store.commit("setScanProvisioning",[]),this.$router.goBack()},onBackPressed:function(){this.isBleScan=!0,EspBleMesh.stopScan(),this.$store.commit("setScanProvisioning",[]),this.$router.goBack()},provisionItem:function(t){var e=this;e.loadingMsg=e.$t("connecting"),console.log("FBY provisionItem: "+e.loadingMsg),e.isBleConnect=!0,this.isBleScan=!0,EspBleMesh.stopScan(),e.pushDeviceId=t.id,e.connectData={id:t.id,type:"provisioning"},console.log("FBY connectData: "+i()(e.connectData)),EspBleMesh.connect(i()(e.connectData)),e.timeOutLoading=setTimeout(function(){e.isBleConnect=!1,e.messageRemind(e.$t("connecttimeout")),EspBleMesh.disconnect()},25e3)},scanCallback:function(t){t=l.a.base64().decode(t),t=JSON.parse(t),l.a._isEmpty(t)||(t.sort(l.a.sortBy("rssi",0)),this.$store.commit("setScanProvisioning",t),console.log("scanCallback: "+i()(t)),this.scanDeviceList=t)},connectCallback:function(t){if(t=l.a.base64().decode(t),console.log("FBY connectCallback"+t+"重试次数"+this.connectContent),t=JSON.parse(t),!l.a._isEmpty(t))switch(t.status){case u.a.STATUS_GATT_CONNECTED:console.log("设备蓝牙连接成功 12345678900987654321"),this.loadingMsg=this.$t("devicebleconnectsuc");break;case u.a.STATUS_GATT_DISCONNECTED:this.connectContent>5?(this.isBleConnect=!1,clearTimeout(this.timeOutLoading),this.messageRemind(this.$t("bleconnectfail"))):(this.loadingMsg=this.$t("devicebleconnectfail"),l.a._isEmpty(this.connectData)||(console.log("fby connect 2"),EspBleMesh.connect(i()(this.connectData))),this.connectContent++);break;case u.a.STATUS_DEVICE_NOT_FOUND:this.isBleConnect=!1,clearTimeout(this.timeOutLoading),this.messageRemind(this.$t("bleparameterfail"));break;case u.a.STATUS_PROVISIONING_READY:this.isBleConnect=!1,this.connectContent=0,this.loadingMsg=this.$t("connecting"),clearTimeout(this.timeOutLoading),this.$router.togo({name:"capabilities",query:{name:t.name,oobMethods:t.oobMethods,deviceId:this.pushDeviceId}})}},provisioningCallback:function(t){t=l.a.base64().decode(t),console.log("FBY provisioningCallback"+t+"重试次数"+this.connectContent),t=JSON.parse(t),l.a._isEmpty(t)||t.status===u.a.STATUS_FAILED&&(this.connectContent>5?(this.isBleConnect=!1,clearTimeout(this.timeOutLoading),this.messageRemind(this.$t("provisioningfail"))):(this.loadingMsg=this.$t("devicerssipool"),l.a._isEmpty(this.connectData)||(console.log("fby FAILED 2"),EspBleMesh.connect(i()(this.connectData))),this.connectContent++))}}),mounted:function(){console.log("Sigprovision 传参打印"+i()(this.$route.query)),this.configType=this.$route.query.type,this.scanDeviceList=this.$store.state.scanProvisioning,this.connectContent=0,this.loadingMsg=this.$t("connecting"),this.scanDevice(this.isBleScan)},computed:c()({},Object(a.b)(["number"]),Object(a.d)({number:function(t){return t.home.number}}),{getBlueEnable:function(){return console.log("状态实时更新"),this.blueEnable=this.$store.state.blueInfo,this.locationGranted=this.$store.state.locationGranted,this.locationEnabled=this.$store.state.locationEnabled,this.blueEnable}})},g={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content-box"},[n("div",{staticClass:"title-info"},[n("h4",{staticClass:"app-title"},[n("span",{on:{click:t.hide}},[n("i",{staticClass:"icon-left back"})]),t._v(t._s(1==t.configType?t.$t("sigprovision"):t.$t("fastprovision")))]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.getBlueEnable,expression:"!getBlueEnable"}],staticClass:"bluetooth-second-base",on:{click:t.showBlueFail}},[n("i",{staticClass:"icon-bluetooth bluetooth-second-style"})]),t._v(" "),n("span",{staticClass:"right-top-text",on:{click:function(e){return t.scanDevice(t.isBleScan)}}},[t._v(t._s(t.isBleScan?t.$t("scan"):t.$t("stopscan")))])]),t._v(" "),n("div",{staticClass:"device-list-base"},[n("div",{staticClass:"overflow-touch"},t._l(t.scanDeviceList,function(e,s){return n("div",{key:s,staticClass:"device-list-cell",on:{click:function(n){return n.target!==n.currentTarget?null:t.provisionItem(e)}}},[n("div",{staticClass:"item-content"},[n("span",{on:{click:function(n){return n.stopPropagation(),t.provisionItem(e)}}},[t._v(t._s(e.name))]),t._v(" "),n("span",{staticClass:"desc",on:{click:function(n){return n.stopPropagation(),t.provisionItem(e)}}},[t._v(t._s(e.id))])]),t._v(" "),n("img",{directives:[{name:"show",rawName:"v-show",value:e.rssi<=0,expression:"item.rssi <= 0"}],staticClass:"item-img",attrs:{src:t.getRssiIcon(e.rssi)}}),t._v(" "),n("i",{staticClass:"icon-right text-color"})])}),0)]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isBleConnect,expression:"isBleConnect"}],staticClass:"connect-loading"},[n("span",[t._v(t._s(t.loadingMsg))]),t._v(" "),t._m(0)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"loading-base"},[e("div",{staticClass:"loading-content"})])}]};var v=n("VU/8")(d,g,!1,function(t){n("2hBI")},"data-v-55316ac6",null);e.default=v.exports}});
//# sourceMappingURL=9.89ea821616648a18cafa.js.map