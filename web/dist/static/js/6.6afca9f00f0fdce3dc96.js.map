{"version":3,"sources":["webpack:///src/pages/OTAUpgrade.vue","webpack:///./src/pages/OTAUpgrade.vue?6d61","webpack:///./src/pages/OTAUpgrade.vue"],"names":["OTAUpgrade","data","deviceInfo","this","$store","state","upgradeBinList","isSelectedVersion","isSelectedBin","upgrade","upgradeValue","upgradeSuccess","upgradeFailure","timeCost","timeCostId","scheduleId","created","self","window","res","getOtaBinsCallback","onBackPressed","otaCallback","onActivityPause","onActivityResume","getWiFiInfoCallback","methods","hide","$router","goBack","console","log","EspBleMesh","getWiFiInfo","sendOTAStartData","utils","base64","decode","JSON","parse","_isEmpty","otawifiName","ssid","constant_default","a","KEY_NAME","name","KEY_COMPANY_ID","VALUE_COMPANY_ID","KEY_BIN_ID","binId","KEY_VERSION_CODE","versionCode","stringify_default","startOta","messageRemind","$t","nodeUpgrade","sendOTAMeshData","KEY_DST_ADDRESS","address","KEY_CLEAR_FLASK","sendOtaMeshMessage","setSchedule","setInterval","clearInterval","stopTime","document","getElementById","innerText","style","width","hideUpgrade","stopUpgrade","getBinName","retrySave","otaReboot","getTime","time","getSecond","m","toFixed","s","getMinute","h","getHour","second","minute","switchUpgradeBin","item","isUpgradeSelected","flag","status","OTA_STATUS_MESSAGE_NOT_NEED","OTA_STATUS_MESSAGE_TIMEOUT","OTA_STATUS_MESSAGE_READY","commit","Object","mint_ui_common","$type","title","message","password","showConfirmButton","closeOnClickModal","showCancelButton","cancelButtonText","then","action","gotoSystemSettings","OTA_STATUS_COMPLETE","OTA_STATUS_CONNECTED","OTA_STATUS_PROGRESS","progress","mounted","getOtaBins","activated","pages_OTAUpgrade","render","_vm","_h","$createElement","_c","_self","staticClass","on","click","_v","_s","$event","_l","key","versionName","class","active","attrs","data-value","directives","rawName","value","expression","left","id","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/6.6afca9f00f0fdce3dc96.js","sourcesContent":["<template>\n  <div class=\"content-box\">\n    <div class=\"title-info\">\n      <h4 class=\"app-title\"><span @click=\"hide\"><i class=\"icon-left back\"></i></span>{{deviceInfo.name}}</h4>\n      <span @click=\"nodeUpgrade()\" class=\"right-top-text\">{{$t('upgrade')}}</span>\n    </div>\n    <div class=\"content-info flex-wrapper upgrade-base\">\n      <div class=\"overflow-touch\">\n        <div v-for=\"item in upgradeBinList\" :key=\"item.name\" @click=\"switchUpgradeBin(item)\" class=\"item\">\n          <div class=\"item-name\">\n            <span>{{item.name}}</span>\n            <span class=\"desc\">{{item.versionName}}</span>\n          </div>\n          <div class=\"item-power-small\">\n            <span :data-value=\"item.name\" class=\"span-radio\" :class=\"{'active': isUpgradeSelected(item.name)}\"><span></span></span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div v-show=\"upgrade\" class=\"ota-upgrade\">\n      <div @click=\"hideUpgrade\" class=\"mask\"></div>\n      <div class=\"upgrade-info\">\n        <h3>{{$t('otaUpdate')}}</h3>\n        <div class=\"progress-info\">\n          <span :style=\"{'left': upgradeValue + '%'}\" class=\"progress-value upgrade-progress-value\" id=\"update-progress-vule\" :class=\"{'active': upgradeFailure}\">0%</span>\n          <div class=\"ota-progress\">\n            <div class=\"ota-progress-progress upgradeProgress\" id=\"update-progress-view\" :class=\"{'active': upgradeFailure}\"></div>\n          </div>\n          <p class=\"progress-details\">\n            <span>{{$t('deviceUpgradingDesc')}}</span>\n            <span>{{getBinName()}}</span>\n            <span class=\"text-right\">{{timeCost}}</span>\n          </p>\n          <div v-show=\"!upgradeSuccess && !upgradeFailure\" class=\"result-success\">\n            <button @click=\"stopUpgrade\" class=\"btn register-btn\">{{$t('cancelBtn')}}</button>\n          </div>\n          <div v-show=\"upgradeSuccess\" class=\"result-success\">\n            <p>{{$t('upgradeSucDesc')}}</p>\n            <div class=\"result-flex\">\n              <button @click=\"stopUpgrade\" class=\"btn register-btn retry\">{{$t('cancelBtn')}}</button>\n              <button @click=\"otaReboot\" class=\"btn register-btn\">{{$t('confirmBtn')}}</button>\n            </div>\n          </div>\n          <div v-show=\"upgradeFailure\" class=\"result-failure\">\n            <p>{{$t('upgradeFailDesc')}}</p>\n            <div class=\"result-flex\">\n              <button @click=\"retrySave\" class=\"btn register-btn retry\">{{$t('retryBtn')}}</button>\n              <button @click=\"otaReboot\" class=\"btn register-btn\">{{$t('confirmBtn')}}</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Util from '../assets/tool/utils'\nimport Constant from \"../assets/tool/constant\";\nimport {MessageBox} from \"mint-ui\";\nexport default {\n  data () {\n    return {\n      deviceInfo: this.$store.state.deviceInfo,\n      upgradeBinList: [],\n      isSelectedVersion: '',\n      isSelectedBin: {},\n      upgrade: false,\n      upgradeValue: 0,\n      upgradeSuccess: false,\n      upgradeFailure: false,\n      timeCost: '00:00:00',\n      timeCostId: '',\n      scheduleId: ''\n    }\n  },\n  created () {\n    var self = this\n    window['getOtaBinsCallback'] = (res) => {\n      self.getOtaBinsCallback(res)\n    }\n    window['onBackPressed'] = () => {\n      self.onBackPressed()\n    }\n    window['otaCallback'] = (res) => {\n      self.otaCallback(res)\n    }\n    window['onActivityPause'] = () => {\n      self.onActivityPause()\n    }\n    window['onActivityResume'] = () => {\n      self.onActivityResume()\n    }\n    window['getWiFiInfoCallback'] = (res) => {\n      self.getWiFiInfoCallback(res)\n    }\n  },\n  methods: {\n    hide () {\n      this.$router.goBack()\n    },\n    // 程序进入后台\n    onActivityPause () {\n      console.log('程序进入后台')\n    },\n    // 程序返回前台\n    onActivityResume () {\n      console.log('程序返回前台')\n      EspBleMesh.getWiFiInfo()\n    },\n    getWiFiInfoCallback (res) {\n      var self = this\n      var sendOTAStartData = {}\n      res = Util.base64().decode(res)\n      console.log('FBY OTA getWiFiInfoCallback' + res)\n      res = JSON.parse(res)\n      if (!Util._isEmpty(res)) {\n        if (self.$store.state.otawifiName === res.ssid) {\n          sendOTAStartData[Constant.KEY_NAME] = self.isSelectedBin.name\n          sendOTAStartData[Constant.KEY_COMPANY_ID] = Constant.VALUE_COMPANY_ID\n          sendOTAStartData[Constant.KEY_BIN_ID] = self.isSelectedBin.binId\n          sendOTAStartData[Constant.KEY_VERSION_CODE] = self.isSelectedBin.versionCode\n          console.log('FBY OTA 开始升级 sendOTAStartData' + JSON.stringify(sendOTAStartData))\n          EspBleMesh.startOta(JSON.stringify(sendOTAStartData))\n        } else {\n          Util.messageRemind(self.$t('wificonnecterror'))\n        }\n      }\n    },\n    onBackPressed () {\n      this.$router.goBack()\n    },\n    nodeUpgrade () {\n      var self = this\n      var sendOTAMeshData = {}\n      if (!Util._isEmpty(self.isSelectedBin)) {\n        sendOTAMeshData[Constant.KEY_DST_ADDRESS] = self.deviceInfo.address\n        sendOTAMeshData[Constant.KEY_COMPANY_ID] = Constant.VALUE_COMPANY_ID\n        sendOTAMeshData[Constant.KEY_BIN_ID] = self.isSelectedBin.binId\n        sendOTAMeshData[Constant.KEY_VERSION_CODE] = self.isSelectedBin.versionCode\n        sendOTAMeshData[Constant.KEY_CLEAR_FLASK] = false\n        console.log('FBY OTA 开始升级 sendOTAMeshData' + JSON.stringify(sendOTAMeshData))\n        EspBleMesh.sendOtaMeshMessage(JSON.stringify(sendOTAMeshData))\n      } else {\n        Util.messageRemind(self.$t('updatefile'))\n      }\n      // self.upgrade = true\n      // self.getTime()\n      // self.setSchedule()\n    },\n    setSchedule () {\n      var self = this\n      self.scheduleId = setInterval(function() {\n        console.log(self.upgradeValue)\n        if (self.upgradeValue >= 5 || self.upgradeFailure) {\n          clearInterval(self.scheduleId)\n          self.stopTime()\n          self.upgradeFailure = true\n        } else {\n          self.upgradeValue += 2\n          document.getElementById('update-progress-vule').innerText = self.upgradeValue + '%'\n          document.getElementById('update-progress-view').style.width = self.upgradeValue + '%'\n          // self.setProgress(self.upgradeValue)\n        }\n      }, 2000)\n    },\n    // 空白区域取消\n    hideUpgrade () {\n      if (this.upgradeFailure) {\n        this.upgrade = false\n        this.upgradeFailure = false\n        clearInterval(this.scheduleId)\n        // this.showPart = false\n        // $(\"span.upgrade-progress-value\").text(\"0%\")\n        // $(\"div.upgradeProgress\").css(\"width\", \"0%\")\n      }\n    },\n    // 取消\n    stopUpgrade () {\n      this.upgrade = false\n      this.upgradeFailure = false\n      clearInterval(this.scheduleId)\n      this.stopTime()\n      // this.hideSuccess()\n      // this.stopOTA()\n    },\n    getBinName () {\n      if (!Util._isEmpty(this.isSelectedBin)) {\n        return this.isSelectedBin.name\n      }\n      return ''\n    },\n    // 重试\n    retrySave () {\n      this.upgrade = false\n      this.upgradeFailure = false\n      clearInterval(this.scheduleId)\n    },\n    // 确定\n    otaReboot () {\n      this.upgrade = false\n      this.upgradeFailure = false\n      clearInterval(this.scheduleId)\n    },\n    getTime () {\n      var self = this\n      self.timeCost = '00:00:00'\n      var time = 0\n      self.timeCostId = setInterval(function() {\n        time ++\n        if (time < 60 ) {\n          self.timeCost = '00:00:' + self.getSecond(time)\n        } else if (time < 3600 ) {\n          var m = (time / 60).toFixed(0)\n          var s = time % 60\n          self.timeCost = '00:' + self.getMinute(m) + ':' + self.getSecond(s)\n        } else {\n          var h = (time / 3600).toFixed(0)\n          var m = (time % 3600 / 60).toFixed(0)\n          var s = (time % 60)\n          self.timeCost = self.getHour(h) + ':' + self.getMinute(m) + ':' + self.getSecond(s)\n        }\n      }, 1000)\n    },\n    getSecond (time) {\n      var second = 0\n      if (time < 10) {\n        second= '0' + time\n      } else if (time < 60 ) {\n        second = time\n      }\n      return second\n    },\n    getMinute (time) {\n      var minute = 0\n      if (time < 10) {\n        minute= '0' + time\n      } else if (time < 60 ) {\n        minute = time\n      }\n      return minute\n    },\n    getHour (time) {\n      var hour = 0\n      if (time < 10) {\n        hour= '0' + time\n      } else {\n        hour = time\n      }\n      return hour\n    },\n    stopTime () {\n      var self = this\n      clearInterval(self.timeCostId)\n    },\n    // 升级文件\n    switchUpgradeBin (item) {\n      var self = this\n      console.log('选择升级文件版本： ' + item.name)\n      if (self.isSelectedVersion !== item.name) {\n        self.isSelectedVersion = item.name\n        self.isSelectedBin = item\n      }\n    },\n    isUpgradeSelected (name) {\n      // console.log('选择升级版本： ' + version)\n      var self = this\n      var flag = false\n      if (self.isSelectedVersion === name) {\n        flag = true\n      }\n      return flag\n    },\n    getOtaBinsCallback (res) {\n      var self = this\n      res = Util.base64().decode(res)\n      console.log('FBY OTA getOtaBinsCallback' + res)\n      res = JSON.parse(res)\n      if (!Util._isEmpty(res)) {\n        self.upgradeBinList = res\n      }\n    },\n    otaCallback (res) {\n      var self = this\n      res = Util.base64().decode(res)\n      console.log('FBY OTA otaCallback' + res)\n      res = JSON.parse(res)\n      if (!Util._isEmpty(res)) {\n        if (res.status === Constant.OTA_STATUS_MESSAGE_NOT_NEED) {\n          Util.messageRemind(self.$t('notneedupdate'))\n        } else if (res.status === Constant.OTA_STATUS_MESSAGE_TIMEOUT) {\n        } else if (res.status === Constant.OTA_STATUS_MESSAGE_READY) {\n          console.log('链接Wi-Fi')\n          self.$store.commit('setotawifiName', res.ssid)\n          MessageBox({\n            $type: 'alert',\n            title: self.$t('switchnetwork'),\n            message: 'SSID: ' + res.ssid + '\\n' + ' PASSWORD: ' + res.password,\n            showConfirmButton: false,\n            closeOnClickModal: false,\n            showCancelButton: true,\n            cancelButtonText: self.$t('settings')\n          }).then(action => {\n            console.log('点击设置按钮')\n            EspBleMesh.gotoSystemSettings('wifi')\n            // self.removeDevices()\n            // self.backHome(res.node)\n          })\n        } else if (res.status === Constant.OTA_STATUS_COMPLETE) {\n          console.log('升级完成')\n        } else if (res.status === Constant.OTA_STATUS_CONNECTED) {\n          console.log('建立升级链接')\n        } else if (res.status === Constant.OTA_STATUS_PROGRESS) {\n          console.log('升级中' + res.progress)\n        }\n      }\n    }\n  },\n  mounted () {\n    var self = this\n    console.log('mounted 走了 deviceInfo' + JSON.stringify(self.deviceInfo))\n    EspBleMesh.getOtaBins()\n    // self.upgradeBinList = [{'name': 'Node_Bin_v1.0.10', 'appVersionName': '1.0.10'}, {'name': 'Node_Bin_v1.0.9', 'appVersionName': '1.0.9'},\n    //   {'name': 'Node_Bin_v1.0.8', 'appVersionName': '1.0.8'}, {'name': 'Node_Bin_v1.0.7', 'appVersionName': '1.0.7'}, {'name': 'Node_Bin_v1.0.6', 'appVersionName': '1.0.6'},\n    //   {'name': 'Node_Bin_v1.0.5', 'appVersionName': '1.0.5'}, {'name': 'Node_Bin_v1.0.4', 'appVersionName': '1.0.4'}, {'name': 'Node_Bin_v1.0.3', 'appVersionName': '1.0.3'},\n    //   {'name': 'Node_Bin_v1.0.2', 'appVersionName': '1.0.2'}, {'name': 'Node_Bin_v1.0.1', 'appVersionName': '1.0.1'}, {'name': 'Node_Bin_v1.0.0', 'appVersionName': '1.0.0'}]\n  },\n  activated () {\n    console.log('activated 走了')\n  }\n}\n</script>\n\n<style scoped lang=\"less\">\n  @import '../assets/css/index.less';\n  .upgrade-base {\n    position: relative;\n    top: 50px;\n    height: calc(100% - 50px) !important;\n  }\n  .ota-upgrade {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    width: 100%;\n    z-index: 200;\n  }\n  .ota-upgrade .mask {\n    height: 100%;\n    width: 100%;\n    background: rgba(0, 0, 0, .6);\n  }\n  .upgrade-info {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 88%;\n    max-width: 550px;\n    background: #fff;\n    border-radius: 5px;\n    padding: 10px 20px;\n    -webkit-transform: translate3d(-50%, -50%, 0);\n    transform: translate3d(-50%, -50%, 0);\n    box-sizing: border-box;\n  }\n  .upgrade-info h3 {\n    position: relative;\n    text-align: center;\n  }\n  .upgrade-details {\n    position: absolute;\n    right: 0;\n    color: #fa2d28;\n  }\n  .upgrade-details-info {\n    max-height: 200px;\n    overflow: hidden;\n    overflow-y: auto;\n    margin-bottom: 10px;\n  }\n  .details-item {\n    display: flex;\n    justify-content: space-between;\n    border-top: 1px solid #e6e6e6;\n    padding: 6px;\n  }\n  .progress-info {\n    margin: 20px 0;\n  }\n  .progress-info span {\n    position: relative;\n    bottom: -3px;\n    color: #fa2d28;\n  }\n  .progress-info span.active {\n    color: #999;\n  }\n  .progress-info p {\n    color: #858585;\n  }\n  .upgrade-progress-value {\n    display: inline-block;\n    -webkit-transform: translate(-35%, 0);\n    transform: translate(-35%, 0);\n    transition: all .3s linear;\n  }\n  .ota-progress {\n    margin-top: 5px;\n    width: 100%;\n    height: 10px;\n    border: none;\n    background: #ebebeb;\n    border-radius: 5px;\n  }\n  .ota-progress-progress {\n    background-color: #fa2d28;\n    border-radius: 5px;\n    height: 100%;\n    width: 0;\n    -webkit-transition: all .3s linear;\n    transition: all .3s linear;\n  }\n  .ota-progress-progress.active {\n    background-color: #999;\n  }\n  .progress-details {\n    display: flex;\n    align-items: center;\n    margin: 10px 0;\n  }\n  .progress-details span {\n    flex: 1;\n    color: #858585;\n    font-size: 12px;\n  }\n  .result-success p,\n  .result-failure p {\n    margin: 10px 0;\n    color: #fa2d28;\n    font-size: 12px;\n  }\n  .btn {\n    display: inline-block;\n    padding: 12px;\n    font-size: 14px;\n    width: 100%;\n    min-width: 100px;\n    margin: 0 auto;\n    color: #fff;\n    border-radius: 5px;\n    -webkit-transition: all .3s linear;\n    transition: all .3s linear;\n  }\n  .register-btn {\n    background: #fa2d28;\n    border: 1px solid #fa2d28;\n  }\n  .result-flex {\n    display: flex;\n    align-items: center;\n  }\n  .result-flex button:first-child {\n    margin-right: 5px;\n  }\n  .retry {\n    color: #656b79;\n    background-color: #f6f8fa;\n    border-color: #f6f8fa;\n  }\n  .text-right {\n    text-align: right;\n  }\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/pages/OTAUpgrade.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content-box\"},[_c('div',{staticClass:\"title-info\"},[_c('h4',{staticClass:\"app-title\"},[_c('span',{on:{\"click\":_vm.hide}},[_c('i',{staticClass:\"icon-left back\"})]),_vm._v(_vm._s(_vm.deviceInfo.name))]),_vm._v(\" \"),_c('span',{staticClass:\"right-top-text\",on:{\"click\":function($event){return _vm.nodeUpgrade()}}},[_vm._v(_vm._s(_vm.$t('upgrade')))])]),_vm._v(\" \"),_c('div',{staticClass:\"content-info flex-wrapper upgrade-base\"},[_c('div',{staticClass:\"overflow-touch\"},_vm._l((_vm.upgradeBinList),function(item){return _c('div',{key:item.name,staticClass:\"item\",on:{\"click\":function($event){return _vm.switchUpgradeBin(item)}}},[_c('div',{staticClass:\"item-name\"},[_c('span',[_vm._v(_vm._s(item.name))]),_vm._v(\" \"),_c('span',{staticClass:\"desc\"},[_vm._v(_vm._s(item.versionName))])]),_vm._v(\" \"),_c('div',{staticClass:\"item-power-small\"},[_c('span',{staticClass:\"span-radio\",class:{'active': _vm.isUpgradeSelected(item.name)},attrs:{\"data-value\":item.name}},[_c('span')])])])}),0)]),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.upgrade),expression:\"upgrade\"}],staticClass:\"ota-upgrade\"},[_c('div',{staticClass:\"mask\",on:{\"click\":_vm.hideUpgrade}}),_vm._v(\" \"),_c('div',{staticClass:\"upgrade-info\"},[_c('h3',[_vm._v(_vm._s(_vm.$t('otaUpdate')))]),_vm._v(\" \"),_c('div',{staticClass:\"progress-info\"},[_c('span',{staticClass:\"progress-value upgrade-progress-value\",class:{'active': _vm.upgradeFailure},style:({'left': _vm.upgradeValue + '%'}),attrs:{\"id\":\"update-progress-vule\"}},[_vm._v(\"0%\")]),_vm._v(\" \"),_c('div',{staticClass:\"ota-progress\"},[_c('div',{staticClass:\"ota-progress-progress upgradeProgress\",class:{'active': _vm.upgradeFailure},attrs:{\"id\":\"update-progress-view\"}})]),_vm._v(\" \"),_c('p',{staticClass:\"progress-details\"},[_c('span',[_vm._v(_vm._s(_vm.$t('deviceUpgradingDesc')))]),_vm._v(\" \"),_c('span',[_vm._v(_vm._s(_vm.getBinName()))]),_vm._v(\" \"),_c('span',{staticClass:\"text-right\"},[_vm._v(_vm._s(_vm.timeCost))])]),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.upgradeSuccess && !_vm.upgradeFailure),expression:\"!upgradeSuccess && !upgradeFailure\"}],staticClass:\"result-success\"},[_c('button',{staticClass:\"btn register-btn\",on:{\"click\":_vm.stopUpgrade}},[_vm._v(_vm._s(_vm.$t('cancelBtn')))])]),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.upgradeSuccess),expression:\"upgradeSuccess\"}],staticClass:\"result-success\"},[_c('p',[_vm._v(_vm._s(_vm.$t('upgradeSucDesc')))]),_vm._v(\" \"),_c('div',{staticClass:\"result-flex\"},[_c('button',{staticClass:\"btn register-btn retry\",on:{\"click\":_vm.stopUpgrade}},[_vm._v(_vm._s(_vm.$t('cancelBtn')))]),_vm._v(\" \"),_c('button',{staticClass:\"btn register-btn\",on:{\"click\":_vm.otaReboot}},[_vm._v(_vm._s(_vm.$t('confirmBtn')))])])]),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.upgradeFailure),expression:\"upgradeFailure\"}],staticClass:\"result-failure\"},[_c('p',[_vm._v(_vm._s(_vm.$t('upgradeFailDesc')))]),_vm._v(\" \"),_c('div',{staticClass:\"result-flex\"},[_c('button',{staticClass:\"btn register-btn retry\",on:{\"click\":_vm.retrySave}},[_vm._v(_vm._s(_vm.$t('retryBtn')))]),_vm._v(\" \"),_c('button',{staticClass:\"btn register-btn\",on:{\"click\":_vm.otaReboot}},[_vm._v(_vm._s(_vm.$t('confirmBtn')))])])])])])])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-9268c5d2\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/OTAUpgrade.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-9268c5d2\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./OTAUpgrade.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./OTAUpgrade.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./OTAUpgrade.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-9268c5d2\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./OTAUpgrade.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-9268c5d2\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/OTAUpgrade.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}